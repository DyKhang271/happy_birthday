<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday Trúc Hân</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="img/banhsinhnhat.jpeg" />
  <style>
    :root {
      --pink: #ffafcc;
      --pink-light: #ffd6ec;
      --blue: #b4f1ff;
      --text-dark: #262224;
      --text-light: #a28eae;
      --text-sweet: #fd83ad;
      --error-color: #ff5c77;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(135deg, #ffd6ec 0%, #b4f1ff 100%);
      overflow-x: hidden;
      position: relative;
    }

    .hearts {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
    }

    .container {
      min-height: 100vh;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
      position: relative;
    }

    .card {
      position: relative;
      max-width: 320px;
      width: 96vw;
      padding: 32px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-radius: 32px;
      box-shadow: 0 8px 32px rgba(246, 180, 219, 0.11);
      background-color: #fff;
      opacity: 1;
      visibility: visible;
      transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("img/img1.jpeg");
      background-size: cover;
      background-position: center 15%;
      filter: brightness(0.7) blur(4px);
      border-radius: 32px;
      z-index: 0;
      opacity: 0.9;
    }
    .card > * {
      position: relative;
      z-index: 1;
    }

    #lockScreen {
      background-color: transparent;
      box-shadow: 0 8px 32px rgba(246, 180, 219, 0.6);
      backdrop-filter: blur(5px);
    }
    #lockScreen::before {
      display: none !important;
    }

    .hidden {
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
      position: absolute !important;
    }

    .password-container {
      position: relative;
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .input-pass {
      font-size: 1.5rem;
      border: 2px solid transparent;
      border-radius: 12px;
      text-align: center;
      padding: 8px 40px 8px 8px;
      width: 150px;
      background: #fff;
      letter-spacing: 8px;
      outline: none;
      box-shadow: 0 1px 4px #eee;
      font-weight: bold;
      color: #333;
      transition: all 0.3s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .input-error {
      border-color: var(--error-color);
      color: var(--error-color);
      font-weight: 500;
      font-size: 1rem !important;
      letter-spacing: 0px !important;
      animation: shake 0.3s ease-in-out;
    }

    .eye-toggle {
      position: absolute;
      right: 12px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .eye-toggle.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .eye-icon {
      width: 22px;
      height: 22px;
      fill: var(--text-sweet);
    }

    .number-pad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 16px;
      width: 80%;
      max-width: 240px;
    }
    .number-btn, .btn-check, .btn-del {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      font-size: 1.6rem;
      font-weight: bold;
      width: 60px;
      height: 60px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dark);
    }
    .number-btn:active, .btn-check:active, .btn-del:active {
        transform: scale(0.9);
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .btn-check, .btn-del {
      background: linear-gradient(135deg, var(--text-sweet), var(--pink));
      color: #fff;
      font-size: 1.8rem;
    }
    #numberPad {
        grid-template-areas: "b1 b2 b3" "b4 b5 b6" "b7 b8 b9" "del b0 check";
    }
    .number-btn[data-num="1"] { grid-area: b1; } .number-btn[data-num="2"] { grid-area: b2; } .number-btn[data-num="3"] { grid-area: b3; }
    .number-btn[data-num="4"] { grid-area: b4; } .number-btn[data-num="5"] { grid-area: b5; } .number-btn[data-num="6"] { grid-area: b6; }
    .number-btn[data-num="7"] { grid-area: b7; } .number-btn[data-num="8"] { grid-area: b8; } .number-btn[data-num="9"] { grid-area: b9; }
    .number-btn[data-num="0"] { grid-area: b0; }
    .btn-del { grid-area: del; }
    .btn-check { grid-area: check; }


    .custom-avatar {
      margin: 16px 0;
      width: 110px;
      height: 110px;
      border-radius: 24px;
      object-fit: cover;
      box-shadow: 0 8px 16px rgba(253, 131, 173, 0.2), 0 4px 8px rgba(253, 131, 173, 0.1);
      background: #f6e3f7;
      border: 3px solid rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
    }
    .custom-avatar:hover {
      transform: scale(1.05) rotate(2deg);
      box-shadow: 0 12px 24px rgba(253, 131, 173, 0.3), 0 6px 12px rgba(253, 131, 173, 0.2);
    }
    
    .greeting {
      font-family: 'Pacifico', cursive;
      color: var(--text-sweet);
      font-size: 2.2rem;
      margin-bottom: 10px;
      text-align: center;
      letter-spacing: 1px;
    }

    .love-note {
      font-size: 1.02rem;
      color: #888;
      margin-bottom: 8px;
      text-align: center;
      font-style: italic;
      min-height: 50px;
      white-space: pre-wrap;
      font-family: 'Pacifico', cursive;
      color: var(--text-sweet);
      width: 100%;
    }
    
    #mainScreen {
        position: relative; 
        padding-bottom: 50px;
    }
    .signed-by-inline {
        position: absolute;
        bottom: 24px;
        right: 24px;
    }
    .signed-by-inline a {
      font-size: 1rem;
      font-style: italic;
      color: #a28eae !important;
      font-family: 'Pacifico', cursive;
      user-select: none;
      text-decoration: none;
      transition: color 0.3s;
    }
    .signed-by-inline a:hover {
        color: var(--text-sweet) !important;
    }

    .letter-inside {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -55%);
      width: 95vw;
      max-width: 320px;
      z-index: 999;
      animation: popin 0.6s;
      text-align: center;
      font-family: 'Pacifico', cursive;
      color: #fd83ad;
      font-size: 1.1rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 24px #e6b3b766;
      padding: 18px 12px 60px 12px;
      box-sizing: border-box;
      overflow: hidden;
    }
    @keyframes popin {
      from { opacity: 0; transform: translate(-50%, -30px); }
      to { opacity: 1; transform: translate(-50%, -55%); }
    }
    .close-letter-container {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
    }
    .close-letter {
      min-width: 85px; font-size: 1em; padding: 0.45em 1.15em; border-radius: 12px; border: none;
      background: linear-gradient(95deg, #fd83ad 55%, #e7c1e8 100%);
      color: #fff; cursor: pointer; box-shadow: 0 2px 8px #f7c6ea90;
      font-family: 'Quicksand', sans-serif; font-weight: bold;
      display: none;
    }
    .close-letter.show {
      display: inline-block !important;
    }
    
    button#openLetterBtn {
        display: flex; justify-content: center; align-items: center; padding: 5px 10px 5px 7px;
        box-shadow: rgba(10, 37, 64, 0.35) 0px -2px 6px 0px inset; background-color: #e8e8e8;
        border-color: #ffe2e252; border-style: solid; border-width: 9px; border-radius: 35px;
        font-size: 25px; cursor: pointer; font-weight: 900; color: rgb(134, 124, 124);
        font-family: monospace; transition: transform 400ms cubic-bezier(0.68, -0.55, 0.27, 2.5), border-color 400ms ease-in-out, background-color 400ms ease-in-out;
        word-spacing: -2px; position: relative; overflow: visible;
    }
    button#openLetterBtn svg { margin-right: 11px; fill: rgb(255, 110, 110); transition: opacity 100ms ease-in-out; }
    button#openLetterBtn .filled { position: absolute; opacity: 0; top: 5px; left: 7px; pointer-events: none; user-select: none; }
    button#openLetterBtn.pressed .empty { opacity: 0 !important; transition: opacity 0.3s ease-in-out; }
    button#openLetterBtn.pressed .filled { opacity: 1 !important; animation: beatingHeart 1.2s infinite; transition: opacity 0.3s ease-in-out; }
    @keyframes movingBorders { 0% {border-color: #fce4e4;} 50% {border-color: #ffd8d8;} 90% {border-color: #fce4e4;} }
    button#openLetterBtn:hover { background-color: #eee; transform: scale(105%); animation: movingBorders 3s infinite; }
    @keyframes beatingHeart { 0% { transform: scale(1); } 15% { transform: scale(1.15); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }
    button#openLetterBtn:hover .empty { opacity: 0; }
    button#openLetterBtn:hover .filled { opacity: 1; animation: beatingHeart 1.2s infinite; }

    .cute-photo-frame {
      position: relative; width: 120px; height: 120px; margin: 0 auto 18px auto;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #ffe3f8 60%, #e0f7fa 100%);
      border-radius: 26px; box-shadow: 0 4px 16px #fda3c722, 0 1.5px 8px #b2ebf26e;
      border: 3px dashed #fd83adbb; overflow: visible; transition: box-shadow 0.3s, transform 0.3s;
    }
    .cute-photo-frame:hover { transform: scale(1.05) rotate(-2deg); box-shadow: 0 10px 28px #fda3c749, 0 3px 12px #b2ebf2aa; }
    .img-in-letter-cute {
      width: 98px; height: 98px; object-fit: cover; border-radius: 20px;
      border: 2.5px solid #fff9; box-shadow: 0 1.5px 8px #fda3c744;
      position: relative; z-index: 2; background: #fdf6fb;
      transition: opacity 0.4s ease-in-out;
    }
    .sticker { position: absolute; width: 26px; height: 26px; z-index: 3; pointer-events: none; opacity: 0.88; filter: drop-shadow(0 1px 3px #fff8); transition: transform 0.22s; }
    .sticker-heart { top: -12px; left: -12px; transform: rotate(-16deg); }
    .sticker-star { bottom: -13px; right: -10px; transform: rotate(15deg) scale(1.05); }
    .sticker-bow { top: -12px; right: -7px; transform: rotate(7deg) scale(0.9); }
    .cute-photo-frame:hover .sticker { transform: scale(1.1) translateY(-3px); opacity: 1; }
    
    .confetti-piece { position: fixed; width: 10px; height: 15px; background-color: #f00; opacity: 0; z-index: 1000; pointer-events: none; }
    
    .bottom-quote {
      width: 100%;
      text-align: center;
      font-size: 1.01rem;
      color: #a28eae;
      font-style: italic;
      letter-spacing: 0.1px;
      margin-top: 15px;
    }

  </style>
</head>
<body>
  <canvas class="hearts"></canvas>
  
  <div class="container">
    <div class="card" id="lockScreen">
      <img src="img/img6.jpeg" alt="avatar" class="custom-avatar" id="avatarImg" />
      <div style="font-size:1.13rem; margin-bottom: 12px; color: #fd83ad; font-weight:bold;">
        ✨ NHẬP PASS ĐI NGƯỜI ĐẸP ✨
      </div>
      <div class="password-container">
        <input class="input-pass" id="inputPass" type="password" maxlength="8" readonly />
        <button class="eye-toggle" id="eyeToggle" onclick="togglePasswordVisibility()">
          <svg class="eye-icon" id="eyeOpen" viewBox="0 0 24 24" style="display: none;"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
          <svg class="eye-icon" id="eyeClosed" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
        </button>
      </div>
      <div class="number-pad" id="numberPad"></div>
      
      <div class="bottom-quote">"Có những điều không nói ra <br> nhưng ánh mắt đã trả lời"</div>
    </div>

    <div class="card hidden" id="mainScreen">
      <div class="greeting">
        Happy Birthday Yêu🎉<span style="font-size:1.3em"></span>
      </div>
      <img src="img/banhsinhnhat.jpeg" class="avatar" style="width:250px; height:250px; margin:15px auto 0 auto; background: transparent; object-fit: contain; border-radius: 16px; display: block;" />
      <div class="love-note" id="loveNote"></div>
      <button id="openLetterBtn" type="button">
        <svg class="empty" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32"><path fill="none" d="M0 0H24V24H0z"></path><path d="M16.5 3C19.538 3 22 5.5 22 9c0 7-7.5 11-10 12.5C9.5 20 2 16 2 9c0-3.5 2.5-6 5.5-6C9.36 3 11 4 12 5c1-1 2.64-2 4.5-2zm-3.566 15.604c.881-.556 1.676-1.109 2.42-1.701C18.335 14.533 20 11.943 20 9c0-2.36-1.537-4-3.5-4-1.076 0-2.24.57-3.086 1.414L12 7.828l-1.414-1.414C9.74 5.57 8.576 5 7.5 5 5.56 5 4 6.656 4 9c0 2.944 1.666 5.533 4.645 7.903.745.592 1.54 1.145 2.421 1.7.299.189.595.37.934.572.339-.202.635-.383.934-.571z"></path></svg>
        <svg class="filled" height="32" width="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H24V24H0z" fill="none"></path><path d="M16.5 3C19.538 3 22 5.5 22 9c0 7-7.5 11-10 12.5C9.5 20 2 16 2 9c0-3.5 2.5-6 5.5-6C9.36 3 11 4 12 5c1-1 2.64-2 4.5-2z"></path></svg>
        Mở thư nè
      </button>
      <div class="signed-by-inline" id="signedByInline">
        <a href="https://www.facebook.com/TDyK.271" target="_blank">Duy Khang</a>
      </div>
    </div>

    <div class="letter-inside" id="letterInside">
      <div class="cute-photo-frame">
        <img src="img/img2.jpeg" alt="Kỷ niệm" class="img-in-letter-cute" id="slideshowImage" />
        <img src="img/tim.png" class="sticker sticker-heart" alt="Heart sticker" />
        <img src="img/sao.png" class="sticker sticker-star" alt="Star sticker" />
        <img src="img/no.png" class="sticker sticker-bow" alt="Bow sticker" />
      </div>
      <div class="letter-text" id="letterText"></div>
      <div class="close-letter-container">
        <button class="close-letter" id="closeLetterBtn" onclick="closeLetter(event)">Đóng thư</button>
      </div>
    </div>

    <audio id="bgMusic" src="audio/tungngayyeuem.mp3" type="audio/mp3" loop></audio>
  </div>
  <script>
    const CORRECT_PASS = "15072005";
    let passVal = "";
    let isPasswordVisible = false;

    function launchConfetti() {
        const confettiCount = 200;
        const confettiColors = ['#ffafcc', '#b4f1ff', '#f1c40f', '#74b9ff', '#fd79a8'];
        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti-piece');
            document.body.appendChild(confetti);
            confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.top = `${-20 + Math.random() * -80}px`;
            confetti.style.opacity = 1;
            const animation = confetti.animate([
                { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                { transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
            ], { duration: 2000 + Math.random() * 3000, easing: 'ease-out', delay: Math.random() * 1000 });
            animation.onfinish = () => confetti.remove();
        }
    }

    function setupNumberPad() {
        const numberPad = document.getElementById("numberPad");
        numberPad.innerHTML = '';
        for (let i = 1; i <= 9; i++) {
            const btn = document.createElement("button");
            btn.className = "number-btn"; btn.textContent = i; btn.dataset.num = i;
            btn.onclick = () => inputNum(i);
            numberPad.appendChild(btn);
        }
        const btn0 = document.createElement("button");
        btn0.className = "number-btn"; btn0.textContent = "0"; btn0.dataset.num = 0;
        btn0.onclick = () => inputNum(0);
        const btnDel = document.createElement("button");
        btnDel.className = "btn-del"; btnDel.innerHTML = "⌫";
        btnDel.onclick = () => delPass();
        const btnCheck = document.createElement("button");
        btnCheck.className = "btn-check"; btnCheck.innerHTML = "✔";
        btnCheck.onclick = () => checkPass();
        numberPad.appendChild(btnDel); numberPad.appendChild(btn0); numberPad.appendChild(btnCheck);
    }
    
    function updatePasswordDisplay() {
        const inputPass = document.getElementById("inputPass");
        if (isPasswordVisible) {
            inputPass.type = "text";
            inputPass.value = passVal;
            inputPass.style.letterSpacing = '2px';
        } else {
            inputPass.type = "password";
            inputPass.value = passVal;
            inputPass.style.letterSpacing = '8px';
        }
    }

    function inputNum(n) {
      if (passVal.length < 8) {
        passVal += n;
        updatePasswordDisplay();
        toggleEyeVisibility();
      }
    }
    
    function delPass() {
        const inputPass = document.getElementById("inputPass");
        passVal = "";
        inputPass.classList.remove("input-error");
        updatePasswordDisplay();
        toggleEyeVisibility();
    }

    // --- SỬA Ở ĐÂY: Hàm checkPass đã được cập nhật ---
    function checkPass() {
      if (passVal === CORRECT_PASS) {
        document.getElementById("lockScreen").classList.add("hidden");
        document.getElementById("mainScreen").classList.remove("hidden");
        launchConfetti();
        
        // Tự động phát nhạc nền khi nhập đúng mật khẩu
        document.getElementById("bgMusic").play().catch(e => console.error("Lỗi tự động phát nhạc:", e));

      } else {
        const inputPass = document.getElementById("inputPass");
        inputPass.type = 'text';
        inputPass.classList.add("input-error");
        inputPass.value = "Sai mật khẩu rồi! 😢";
        if(window.navigator.vibrate) window.navigator.vibrate(200);
        
        setTimeout(() => {
          inputPass.classList.remove("input-error");
          passVal = "";
          updatePasswordDisplay();
          toggleEyeVisibility();
        }, 1200);
      }
    }

    function togglePasswordVisibility() {
        isPasswordVisible = !isPasswordVisible;
        const eyeOpen = document.getElementById("eyeOpen");
        const eyeClosed = document.getElementById("eyeClosed");
        if (isPasswordVisible) {
            eyeOpen.style.display = "block";
            eyeClosed.style.display = "none";
        } else {
            eyeOpen.style.display = "none";
            eyeClosed.style.display = "block";
        }
        updatePasswordDisplay();
    }

    function toggleEyeVisibility() {
      const eyeToggle = document.getElementById("eyeToggle");
      if (passVal.length > 0) {
        eyeToggle.classList.add("visible");
      } else {
        eyeToggle.classList.remove("visible");
        if (isPasswordVisible) {
            togglePasswordVisibility();
        }
      }
    }
    
    const slideshowImages = ["img/img2.jpeg", "img/img3.jpeg", "img/img4.jpeg", "img/img5.jpeg"];
    let currentSlideIndex = 0;
    let slideInterval;
    function changeSlide() {
        const imgEl = document.getElementById("slideshowImage");
        currentSlideIndex = (currentSlideIndex + 1) % slideshowImages.length;
        imgEl.style.opacity = 0;
        setTimeout(() => { imgEl.src = slideshowImages[currentSlideIndex]; imgEl.style.opacity = 1; }, 400);
    }
    function startSlideshow() {
      currentSlideIndex = 0;
      document.getElementById("slideshowImage").src = slideshowImages[currentSlideIndex];
      slideInterval = setInterval(changeSlide, 3000);
    }
    function stopSlideshow() { clearInterval(slideInterval); }

    let isLetterOpen = false;
    // --- SỬA Ở ĐÂY: Chức năng phát nhạc đã bị xóa khỏi nút này ---
    document.getElementById("openLetterBtn").addEventListener("click", function () {
      if (!isLetterOpen) {
        document.getElementById("letterInside").style.display = "block";
        isLetterOpen = true;
        startSlideshow();
        const letterContent = `\t Chúc mừng sinh nhật 'ai đó' rất đặc biệt! 🎂 \nNghe bảo thêm một tuổi là thêm 'gần' với anh hơn một chút đó 🥳. \nCảm ơn vì đã xuất hiện và thắp sáng những ngày... hơi 'tối' của anh (ý là trước khi gặp em đó nha!). \nChúc 'người ta' tuổi mới ăn no chóng lớn, à nhầm, luôn xinh đẹp, tươi tắn và gặp nhiều điều 'bất ngờ' thú vị... giống như sự xuất hiện của em vậy đó! 😉\n\n\t Yêu 'người ta' nhiều lắm! ❤️`;
        typeWriter(letterContent, "letterText", 60, () => {
          document.getElementById('closeLetterBtn').classList.add('show');
        });
        this.classList.add("pressed");
      }
    });
    
    function closeLetter(e) {
      e.stopPropagation();
      document.getElementById("letterInside").style.display = "none";
      isLetterOpen = false;
      stopSlideshow();
      document.getElementById("openLetterBtn").classList.remove("pressed");
      document.getElementById('letterText').innerHTML = "";
      document.getElementById('closeLetterBtn').classList.remove('show');
    }

    function typeWriter(text, elementId, speed, onDone) {
        let i = 0;
        const el = document.getElementById(elementId);
        el.innerHTML = "";
        function typing() {
            if (i < text.length) {
                let char = text.charAt(i).replace(/\n/g, '<br>').replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
                el.innerHTML += char;
                i++;
                setTimeout(typing, speed);
            } else if (onDone) onDone();
        }
        typing();
    }
    
    const hearts = [];
    const heartCanvas = document.querySelector(".hearts");
    const ctx = heartCanvas.getContext("2d");
    function resizeCanvas() {
        heartCanvas.width = window.innerWidth;
        heartCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    
    let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    document.addEventListener("mousemove", (e) => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
    });

    function randomHeart() {
      return {
        x: Math.random() * heartCanvas.width, y: Math.random() * heartCanvas.height,
        size: 20 + Math.random() * 16, speed: 0.6 + Math.random() * 1.2,
        alpha: 0.7 + Math.random() * 0.2, dx: (Math.random() - 0.5) * 0.5,
      };
    }
    function drawHeart(x, y, size, alpha) {
        ctx.save();
        ctx.globalAlpha = alpha; ctx.translate(x, y);
        ctx.beginPath();
        ctx.moveTo(0, size / 4);
        ctx.bezierCurveTo(size / 2, -size / 2, size, size / 3, 0, size);
        ctx.bezierCurveTo(-size, size / 3, -size / 2, -size / 2, 0, size / 4);
        ctx.closePath();
        ctx.fillStyle = "#fd83ad"; ctx.shadowColor = "#fff"; ctx.shadowBlur = 8;
        ctx.fill();
        ctx.restore();
    }
    function animateHearts() {
      ctx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);
      for (let h of hearts) {
        drawHeart(h.x, h.y, h.size, h.alpha);
        h.y -= h.speed;
        h.x += (mouse.x - h.x) * 0.003 + h.dx;
        if (h.y < -50) {
            let nh = randomHeart();
            h.x = nh.x; h.y = heartCanvas.height + 40; h.size = nh.size;
            h.speed = nh.speed; h.alpha = nh.alpha; h.dx = nh.dx;
        }
      }
      requestAnimationFrame(animateHearts);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        setupNumberPad();
        resizeCanvas();
        for (let i = 0; i < 30; i++) hearts.push(randomHeart());
        animateHearts();
    });
  </script>
</body>
</html>
